@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    --color-canvas: 231 219 208;
    --color-surface: 235 224 216;
    --color-muted: 220 207 196;
    --color-border: 165 143 128;
    --color-secondary: 146 127 114;
    --color-text: 30 30 30;
    --color-text-muted: 93 80 71;
    --color-text-faint: 134 118 106;
    --color-editor-surface: 235 224 216;
    --color-editor-text: 30 30 30;

    --color-brand: 63 111 138;
    --color-brand-hover: 52 94 118;
    --color-brand-soft: 217 229 236;
    --color-brand-contrast: 255 255 255;

    --color-success: 79 122 84;
    --color-success-hover: 65 101 70;
    --color-success-soft: 223 233 225;
    --color-success-contrast: 255 255 255;

    --color-warning: 169 119 37;
    --color-warning-hover: 142 100 32;
    --color-warning-soft: 239 227 207;
    --color-warning-contrast: 255 255 255;

    --color-danger: 178 74 66;
    --color-danger-hover: 151 61 54;
    --color-danger-soft: 243 221 217;
    --color-danger-contrast: 255 255 255;

    --color-info: 95 125 132;
    --color-info-hover: 79 105 112;
    --color-info-soft: 223 232 234;
    --color-info-contrast: 255 255 255;

    --radius-panel: 14px;
    --radius-control: 10px;
    --font-weight-editor-text: 460;

    --shadow-panel: 0 1px 2px rgba(30, 24, 20, 0.05), 0 8px 24px rgba(30, 24, 20, 0.04);
    --shadow-float: 0 18px 50px rgba(30, 24, 20, 0.14);
    --shadow-focus: 0 0 0 3px rgba(63, 111, 138, 0.26);
  }

  * {
    @apply border-border;
  }

  html,
  body,
  #root {
    @apply h-full;
  }

  body {
    @apply m-0 bg-canvas text-text font-sans antialiased;
    background-image:
      radial-gradient(circle at 0% 0%, rgba(63, 111, 138, 0.1), transparent 42%),
      radial-gradient(circle at 100% 0%, rgba(169, 119, 37, 0.1), transparent 36%);
  }

  button,
  input,
  select,
  textarea {
    font: inherit;
  }
}

@layer components {
  .app-shell {
    @apply h-screen flex flex-col;
  }

  .app-topbar {
    @apply px-10 py-4 bg-surface/90 backdrop-blur border-b border-border flex justify-between items-center;
  }

  .app-footer {
    @apply px-10 py-3 bg-surface/85 backdrop-blur border-t border-border text-[10px] text-text-faint flex justify-between;
  }

  .surface-card {
    @apply bg-surface border border-border rounded-panel shadow-panel;
  }

  .surface-subtle {
    @apply bg-muted border border-border rounded-panel;
  }

  .surface-danger {
    @apply bg-danger-soft border border-danger/30 rounded-panel;
  }

  .btn-base {
    @apply inline-flex items-center justify-center gap-2 px-4 py-2 text-sm font-semibold rounded-control transition-colors disabled:opacity-50 disabled:cursor-not-allowed;
  }

  .btn-primary {
    @apply btn-base bg-brand text-brand-contrast hover:bg-brand-hover shadow-panel;
  }

  .btn-secondary {
    @apply btn-base bg-surface text-text-muted border border-border hover:bg-muted;
  }

  .btn-soft {
    @apply btn-base bg-brand-soft text-brand hover:bg-brand-soft/80;
  }

  .btn-danger {
    @apply btn-base bg-danger text-danger-contrast hover:bg-danger-hover;
  }

  .btn-ghost {
    @apply btn-base bg-transparent text-text-muted hover:bg-muted;
  }

  .icon-btn {
    @apply inline-flex items-center justify-center h-8 w-8 rounded-control border transition-colors disabled:opacity-50 disabled:cursor-not-allowed;
  }

  .icon-btn-neutral {
    @apply icon-btn bg-surface text-text-faint border-border hover:text-text-muted hover:bg-muted;
  }

  .icon-btn-brand {
    @apply icon-btn bg-brand-soft text-brand border-brand/20 hover:bg-brand-soft/70;
  }

  .icon-btn-danger {
    @apply icon-btn bg-danger-soft text-danger border-danger/20 hover:bg-danger-soft/70;
  }

  .nav-pill {
    @apply px-4 py-2 text-sm font-semibold rounded-control text-text-muted transition-colors hover:bg-muted;
  }

  .nav-pill-active {
    @apply bg-brand-soft text-brand;
  }

  .field-input {
    @apply w-full px-4 py-2 bg-surface border border-border rounded-control focus:outline-none focus:ring-0;
    box-shadow: none;
  }

  .field-input:focus {
    box-shadow: var(--shadow-focus);
  }

  .field-input-danger {
    @apply border-danger/50;
  }

  .field-input-success {
    @apply border-success/50;
  }

  .field-label {
    @apply block text-xs font-semibold text-text-faint uppercase tracking-wide mb-1;
  }

  .badge {
    @apply inline-flex items-center px-2 py-0.5 rounded-control text-[10px] font-semibold uppercase tracking-wide;
  }

  .badge-brand {
    @apply badge bg-brand-soft text-brand;
  }

  .badge-success {
    @apply badge bg-success-soft text-success;
  }

  .badge-warning {
    @apply badge bg-warning-soft text-warning;
  }

  .badge-danger {
    @apply badge bg-danger-soft text-danger;
  }

  .badge-neutral {
    @apply badge bg-muted text-text-muted;
  }

  .badge-info {
    @apply badge bg-info-soft text-info;
  }

  .notice {
    @apply rounded-control border px-3 py-2 text-sm;
  }

  .notice-success {
    @apply notice bg-success-soft border-success/30 text-success;
  }

  .notice-warning {
    @apply notice bg-warning-soft border-warning/30 text-warning;
  }

  .notice-danger {
    @apply notice bg-danger-soft border-danger/30 text-danger;
  }

  .notice-info {
    @apply notice bg-info-soft border-info/30 text-info;
  }

  .panel-header {
    @apply px-6 py-4 border-b border-border bg-surface/80 backdrop-blur;
  }

  .panel-footer {
    @apply px-6 py-4 border-t border-border bg-muted/75;
  }

  .table-shell {
    @apply border border-border rounded-panel overflow-hidden overflow-x-auto shadow-panel;
  }

  .table-head {
    @apply bg-muted border-b border-border;
  }

  .table-row {
    @apply border-b border-border/40 last:border-b-0;
  }

  .menu-popover {
    @apply rounded-control border border-border bg-surface shadow-float;
  }

  .menu-item {
    @apply w-full px-3 py-2 text-left text-sm text-text-muted hover:bg-muted transition-colors;
  }

  .modal-backdrop {
    @apply fixed inset-0 z-50 flex items-center justify-center p-4 backdrop-blur-sm;
    background-color: rgba(30, 24, 20, 0.32);
  }

  .modal-card {
    @apply bg-surface rounded-panel border border-border w-full overflow-hidden;
    box-shadow: var(--shadow-float);
  }

  .modal-header {
    @apply px-6 py-4 border-b border-border flex justify-between items-center;
  }

  .modal-body {
    @apply p-6 space-y-4;
  }

  .status-note {
    @apply text-xs text-text-muted bg-muted border border-border rounded-control px-3 py-2;
  }

  .editor-text-base {
    @apply w-full min-h-[36px] text-[14px] font-sans leading-normal whitespace-pre-wrap break-words;
    font-weight: var(--font-weight-editor-text);
  }

  .editor-cell-bg {
    background-color: rgb(var(--color-editor-surface));
  }

  .editor-source-text {
    @apply editor-text-base px-0.5 pr-1.5 py-0 select-text;
    color: rgb(var(--color-editor-text));
  }

  .editor-target-text-layer {
    @apply editor-text-base pl-1.5 pr-12 py-0.5;
    color: rgb(var(--color-editor-text));
  }

  .editor-target-editor-host {
    @apply relative w-full;
  }

  /* CM6 target filter highlight fallback: keep this global so highlight remains visible
     even if theme-injected style order changes. */
  .cm-target-highlight {
    background-color: rgba(var(--color-warning), 0.58) !important;
    box-shadow:
      inset 0 0 0 1px rgba(var(--color-warning), 0.92),
      0 0 0 1px rgba(var(--color-warning), 0.55) !important;
    border-radius: 3px !important;
    text-decoration-line: underline !important;
    text-decoration-color: rgba(var(--color-warning), 0.95) !important;
    text-decoration-thickness: 2px !important;
    text-underline-offset: 2px !important;
    font-weight: 600 !important;
  }
}

@layer utilities {
  .custom-scrollbar {
    scrollbar-width: thin;
    scrollbar-color: rgba(165, 143, 128, 0.32) transparent;
  }

  .custom-scrollbar::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }

  .custom-scrollbar::-webkit-scrollbar-thumb {
    background-color: rgba(165, 143, 128, 0.3);
    border-radius: 999px;
    border: 1px solid transparent;
    background-clip: content-box;
  }

  .custom-scrollbar::-webkit-scrollbar-track {
    background: transparent;
  }
}
