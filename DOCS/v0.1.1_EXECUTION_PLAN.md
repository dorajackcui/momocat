# v0.1.1 具体 Task 执行案 (专业项目管理与多文件架构)

本方案旨在将 Simple CAT Tool 从“文件翻译器”升级为“专业项目平台”，引入“项目-文件-句段”三层模型，并确立项目级独立 TM 机制。

## 1. 数据库 Schema 演进 (Schema v2)

### 1.1 数据库表结构调整
*   **新增 `files` 表**：
    *   `id` (PK), `projectId` (FK), `name`, `totalSegments`, `confirmedSegments`, `status`, `createdAt`
*   **重构 `segments` 表**：
    *   将 `projectId` 字段替换为 `fileId` (FK)，使句段直接归属于文件。
*   **索引优化**：
    *   `idx_segment_file_order(fileId, orderIndex)`
    *   `idx_segment_file_srcHash(fileId, srcHash)`

## 2. 核心逻辑层 (Main Process)

### 2.1 ProjectService 重构
*   `createProject(name, src, tgt)`: 仅创建项目容器记录。
*   `addFileToProject(projectId, filePath, options)`: 
    *   读取并解析 Spreadsheet。
    *   在 `files` 表创建记录。
    *   批量插入句段，并关联到 `fileId`。
*   `listFiles(projectId)`: 获取项目下的所有文件及其进度。

### 2.2 TM 查找逻辑 (预留)
*   `lookupProjectTM(projectId, matchKey)`: 在同一项目的所有已确认句段中查找匹配项。

## 3. UI/UX 流程重构

### 3.1 渲染进程视图 (Renderer)
*   **Dashboard**: 保持项目列表展示。
*   **ProjectDetail (新组件)**: 
    *   路由入口：从 Dashboard 点击项目进入。
    *   功能：文件列表、添加文件按钮、项目总体进度条。
*   **Editor**: 
    *   路由入口：从 ProjectDetail 点击具体文件进入。
    *   功能：加载特定文件的句段。

### 3.2 路由状态管理
*   `currentView`: `dashboard` | `projectDetail` | `editor`
*   `activeProjectId`: 当前选中的项目 ID
*   `activeFileId`: 当前正在编辑的文件 ID

## 4. 实施步骤

1.  **packages/db**: 更新 `CATDatabase.ts` 初始化脚本，执行 V2 Schema。
2.  **apps/desktop/main**: 重构 `ProjectService.ts` 及对应的 IPC Handler。
3.  **apps/desktop/preload**: 更新 `api` 对象，增加 `file.*` 相关方法。
4.  **apps/desktop/renderer**: 
    *   创建 `ProjectDetail.tsx`。
    *   重构 `App.tsx` 以支持新的三级视图。
    *   更新 `useProjects` 和 `useEditor` hooks 以适应新模型。

## 5. 验收标准 (DoD)
*   [ ] 能够创建一个不带任何文件的空项目。
*   [ ] 能够向同一个项目添加多个 Excel/CSV 文件。
*   [ ] 项目看板显示各项目的总体进度。
*   [ ] 能够点击项目进入文件列表，再点击文件进入编辑器。
*   [ ] 翻译确认逻辑依然有效，且仅更新当前文件的进度。
