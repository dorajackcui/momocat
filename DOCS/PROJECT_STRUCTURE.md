# é¡¹ç›®ç»“æ„è¯´æ˜

æœ¬é¡¹ç›®é‡‡ç”¨ **Monorepo** æ¶æ„ï¼Œä½¿ç”¨ npm workspaces ç®¡ç†å¤šä¸ªå­åŒ…ã€‚

## ç›®å½•ç»“æ„æ¦‚è§ˆ

```
simple-cat-tool/
â”œâ”€â”€ apps/              # åº”ç”¨ç¨‹åºï¼ˆå¯æ‰§è¡Œçš„åº”ç”¨ï¼‰
â”œâ”€â”€ packages/          # å…±äº«åŒ…ï¼ˆå¯å¤ç”¨çš„åº“ï¼‰
â”œâ”€â”€ out/               # ç¼–è¯‘è¾“å‡ºç›®å½•ï¼ˆæ„å»ºäº§ç‰©ï¼‰
â”œâ”€â”€ projects/          # ç”¨æˆ·æ•°æ®ç›®å½•ï¼ˆè¿è¡Œæ—¶æ•°æ®ï¼‰
â”œâ”€â”€ node_modules/      # ä¾èµ–åŒ…
â””â”€â”€ DOCS/              # æ–‡æ¡£
```

---

## ğŸ“ è¯¦ç»†è¯´æ˜

### 1. `apps/` - åº”ç”¨ç¨‹åºç›®å½•
**ä½œç”¨**ï¼šå­˜æ”¾å¯æ‰§è¡Œçš„åº”ç”¨ç¨‹åº

```
apps/
â””â”€â”€ desktop/           # Electron æ¡Œé¢åº”ç”¨
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ main/      # ä¸»è¿›ç¨‹ï¼ˆNode.js ç¯å¢ƒï¼‰
    â”‚   â”œâ”€â”€ preload/   # é¢„åŠ è½½è„šæœ¬ï¼ˆIPC æ¡¥æ¥ï¼‰
    â”‚   â””â”€â”€ renderer/  # æ¸²æŸ“è¿›ç¨‹ï¼ˆReact UIï¼‰
    â”œâ”€â”€ build/         # æ„å»ºé…ç½®å’Œèµ„æº
    â””â”€â”€ package.json   # åº”ç”¨ä¾èµ–é…ç½®
```

**ç‰¹ç‚¹**ï¼š
- è¿™æ˜¯æœ€ç»ˆç”¨æˆ·è¿è¡Œçš„ç¨‹åº
- ä¾èµ– `packages/` ä¸­çš„å…±äº«åŒ…
- å¯ä»¥æœ‰å¤šä¸ªåº”ç”¨ï¼ˆå¦‚ desktopã€webã€mobileï¼‰

---

### 2. `packages/` - å…±äº«åŒ…ç›®å½•
**ä½œç”¨**ï¼šå­˜æ”¾å¯å¤ç”¨çš„ä¸šåŠ¡é€»è¾‘å’Œå·¥å…·åº“

```
packages/
â”œâ”€â”€ core/              # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ types.ts       # ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ tokenizer.ts   # åˆ†è¯å™¨
â”‚   â”‚   â”œâ”€â”€ qa.ts          # QA è§„åˆ™
â”‚   â”‚   â””â”€â”€ utils.ts       # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ package.json
â”‚
â””â”€â”€ db/                # æ•°æ®åº“å±‚
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ CATDatabase.ts # SQLite å°è£…
    â”‚   â””â”€â”€ migrations.ts  # æ•°æ®åº“è¿ç§»
    â””â”€â”€ package.json
```

**ç‰¹ç‚¹**ï¼š
- çº¯é€»è¾‘ï¼Œä¸ä¾èµ– Electron
- å¯ä»¥è¢«å¤šä¸ªåº”ç”¨å…±äº«
- é€šè¿‡ `@cat/core` å’Œ `@cat/db` å¼•ç”¨

**ä¸ºä»€ä¹ˆè¦åˆ†ç¦»ï¼Ÿ**
- âœ… ä»£ç å¤ç”¨ï¼šæœªæ¥å¯èƒ½æœ‰ Web ç‰ˆã€CLI ç‰ˆ
- âœ… æµ‹è¯•æ–¹ä¾¿ï¼šçº¯é€»è¾‘æ›´å®¹æ˜“å•å…ƒæµ‹è¯•
- âœ… èŒè´£æ¸…æ™°ï¼šä¸šåŠ¡é€»è¾‘ä¸ UI åˆ†ç¦»

---

### 3. `out/` - ç¼–è¯‘è¾“å‡ºç›®å½•
**ä½œç”¨**ï¼šå­˜æ”¾ TypeScript ç¼–è¯‘åçš„ JavaScript ä»£ç 

```
out/
â”œâ”€â”€ main/              # ä¸»è¿›ç¨‹ç¼–è¯‘äº§ç‰©
â”‚   â””â”€â”€ index.js
â”œâ”€â”€ preload/           # é¢„åŠ è½½è„šæœ¬ç¼–è¯‘äº§ç‰©
â”‚   â””â”€â”€ index.js
â””â”€â”€ renderer/          # æ¸²æŸ“è¿›ç¨‹ç¼–è¯‘äº§ç‰©ï¼ˆç”± Vite å¤„ç†ï¼‰
```

**ç‰¹ç‚¹**ï¼š
- ç”± `electron-vite build` è‡ªåŠ¨ç”Ÿæˆ
- ä¸åº”è¯¥æ‰‹åŠ¨ä¿®æ”¹
- å·²åœ¨ `.gitignore` ä¸­å¿½ç•¥ï¼ˆéƒ¨åˆ†ï¼‰
- Electron è¿è¡Œæ—¶è¯»å–è¿™é‡Œçš„æ–‡ä»¶

**ç”Ÿå‘½å‘¨æœŸ**ï¼š
```
å¼€å‘æ¨¡å¼ï¼šnpm run dev â†’ å®æ—¶ç¼–è¯‘åˆ° out/
ç”Ÿäº§æ„å»ºï¼šnpm run build â†’ ç¼–è¯‘åˆ° out/ â†’ æ‰“åŒ…æˆå®‰è£…åŒ…
```

---

### 4. `projects/` - ç”¨æˆ·æ•°æ®ç›®å½•
**ä½œç”¨**ï¼šå­˜æ”¾ç”¨æˆ·åˆ›å»ºçš„ç¿»è¯‘é¡¹ç›®æ•°æ®

```
projects/
â””â”€â”€ (ç©ºç›®å½•ï¼Œè¿è¡Œæ—¶ç”±åº”ç”¨åˆ›å»ºé¡¹ç›®)
```

**å®é™…è¿è¡Œæ—¶å¯èƒ½çš„ç»“æ„**ï¼š
```
projects/
â”œâ”€â”€ project-123/
â”‚   â”œâ”€â”€ cat_v1.db      # é¡¹ç›®æ•°æ®åº“
â”‚   â””â”€â”€ files/         # åŸå§‹æ–‡ä»¶å¤‡ä»½
â””â”€â”€ project-456/
    â””â”€â”€ cat_v1.db
```

**ç‰¹ç‚¹**ï¼š
- ç”¨æˆ·æ•°æ®ï¼Œä¸åº”è¯¥æäº¤åˆ° Git
- å·²åœ¨ `.gitignore` ä¸­é…ç½®
- åº”ç”¨å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨åˆ›å»º

**æ³¨æ„**ï¼šç›®å‰æ•°æ®åº“å¯èƒ½å­˜æ”¾åœ¨ `.cat_data/` ç›®å½•ï¼Œè¿™ä¸ªè®¾è®¡å¯èƒ½éœ€è¦ç»Ÿä¸€ã€‚

---

## ğŸ”„ å·¥ä½œæµç¨‹

### å¼€å‘æµç¨‹
```bash
npm install          # å®‰è£…æ‰€æœ‰ä¾èµ–ï¼ˆæ ¹ç›®å½• + apps + packagesï¼‰
npm run dev          # å¯åŠ¨å¼€å‘æ¨¡å¼
                     # â†“
                     # 1. ç¼–è¯‘ packages/core å’Œ packages/db
                     # 2. ç¼–è¯‘ apps/desktop åˆ° out/
                     # 3. å¯åŠ¨ Electron åº”ç”¨
```

### æ„å»ºæµç¨‹
```bash
npm run build        # æ„å»ºç”Ÿäº§ç‰ˆæœ¬
                     # â†“
                     # 1. ç¼–è¯‘æ‰€æœ‰ TypeScript åˆ° out/
                     # 2. ä¼˜åŒ–å’Œå‹ç¼©ä»£ç 

npm run pack         # æ‰“åŒ…æˆå®‰è£…åŒ…
                     # â†“
                     # ä½¿ç”¨ electron-builder æ‰“åŒ…
                     # è¾“å‡ºåˆ° release/ ç›®å½•
```

---

## ğŸ“¦ ä¾èµ–å…³ç³»

```
apps/desktop
  â”œâ”€â†’ @cat/core      (ä¸šåŠ¡é€»è¾‘)
  â”œâ”€â†’ @cat/db        (æ•°æ®åº“)
  â”œâ”€â†’ react          (UI æ¡†æ¶)
  â”œâ”€â†’ electron       (æ¡Œé¢æ¡†æ¶)
  â””â”€â†’ better-sqlite3 (SQLite é©±åŠ¨)

packages/core
  â””â”€â†’ (æ— å¤–éƒ¨ä¾èµ–ï¼Œçº¯é€»è¾‘)

packages/db
  â””â”€â†’ better-sqlite3 (SQLite é©±åŠ¨)
```

---

## ğŸ¯ Monorepo çš„ä¼˜åŠ¿

1. **ç»Ÿä¸€ç®¡ç†**ï¼šä¸€ä¸ªä»“åº“ç®¡ç†æ‰€æœ‰ä»£ç 
2. **ä»£ç å…±äº«**ï¼š`packages/` ä¸­çš„ä»£ç å¯ä»¥è¢«å¤šä¸ªåº”ç”¨ä½¿ç”¨
3. **ç‰ˆæœ¬ä¸€è‡´**ï¼šæ‰€æœ‰åŒ…ä½¿ç”¨ç›¸åŒçš„ä¾èµ–ç‰ˆæœ¬
4. **åŸå­æäº¤**ï¼šè·¨åŒ…ä¿®æ”¹å¯ä»¥åœ¨ä¸€ä¸ª commit ä¸­å®Œæˆ

---

## ğŸš€ å¸¸è§æ“ä½œ

### æ·»åŠ æ–°çš„å…±äº«åŒ…
```bash
mkdir packages/new-package
cd packages/new-package
npm init -y
# åœ¨ apps/desktop/package.json ä¸­æ·»åŠ ä¾èµ–ï¼š
# "@cat/new-package": "*"
```

### åªè¿è¡ŒæŸä¸ªåº”ç”¨
```bash
npm run dev --workspace=apps/desktop
```

### ç»™ç‰¹å®šåŒ…å®‰è£…ä¾èµ–
```bash
npm install lodash --workspace=packages/core
```

---

## ğŸ“ æ€»ç»“

| ç›®å½• | ä½œç”¨ | æäº¤åˆ° Git | ç¤ºä¾‹å†…å®¹ |
|------|------|-----------|---------|
| `apps/` | å¯æ‰§è¡Œåº”ç”¨ | âœ… æ˜¯ | Electron æ¡Œé¢åº”ç”¨ |
| `packages/` | å…±äº«åº“ | âœ… æ˜¯ | ä¸šåŠ¡é€»è¾‘ã€æ•°æ®åº“å±‚ |
| `out/` | ç¼–è¯‘äº§ç‰© | âš ï¸ éƒ¨åˆ† | JavaScript æ–‡ä»¶ |
| `projects/` | ç”¨æˆ·æ•°æ® | âŒ å¦ | ç¿»è¯‘é¡¹ç›®æ•°æ®åº“ |
| `node_modules/` | ä¾èµ–åŒ… | âŒ å¦ | ç¬¬ä¸‰æ–¹åº“ |

**è®°ä½**ï¼š
- `apps/` å’Œ `packages/` æ˜¯ä½ å†™ä»£ç çš„åœ°æ–¹
- `out/` æ˜¯ç¼–è¯‘å™¨ç”Ÿæˆçš„
- `projects/` æ˜¯ç”¨æˆ·æ•°æ®
- `node_modules/` æ˜¯ä¾èµ–åŒ…
